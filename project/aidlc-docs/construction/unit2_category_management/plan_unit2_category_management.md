# Unit 2: Category Management 도메인 모델 설계 계획

## 개요

카테고리 생성, 수정, 삭제 기능을 담당하는 Unit2에 대한 도메인 주도 설계(DDD) 도메인 모델을 설계합니다.

## 설계 단계별 계획

### 1단계: 도메인 이해 및 분석

- [x] 1.1 사용자 스토리 분석 (US-015, US-016, US-021)
- [x] 1.2 비즈니스 규칙 및 제약사항 식별
- [x] 1.3 도메인 전문가 언어(Ubiquitous Language) 정의

### 2단계: 전술적 설계 - 핵심 도메인 객체 식별

- [x] 2.1 애그리게이트 루트 식별
- [x] 2.2 엔티티 식별
- [x] 2.3 값 객체 식별
- [x] 2.4 도메인 이벤트 식별

### 3단계: 전술적 설계 - 도메인 서비스 및 정책

- [x] 3.1 도메인 서비스 식별
- [x] 3.2 비즈니스 정책 및 규칙 정의
- [x] 3.3 애그리게이트 경계 정의

### 4단계: 인프라스트럭처 설계

- [x] 4.1 리포지토리 인터페이스 정의
- [x] 4.2 외부 서비스 인터페이스 정의 (필요시)

### 5단계: 통합 및 검증

- [x] 5.1 Integration Contract와의 일관성 검증
- [x] 5.2 필요한 오류 코드 추가 (integration_contract.md)
- [x] 5.3 도메인 모델 문서 작성 완료

## 요구사항 정리

### 기본 요구사항

- 카테고리는 **최대 3계층의 계층 구조**를 가질 수 있음
- 사용자당 최대 100개 카테고리 생성 가능 ('임시', '공유받은 카드' 포함)
- 카테고리 이름: 최대 10글자, 영어/숫자/한글/밑줄(\_)만 허용, 띄어쓰기 금지, 중복 불가

### 특수 카테고리

- **"공유받은 카드"**: 회원가입 시 자동 생성, 삭제/이름변경 불가, 카드를 내 카테고리로 이동 가능
- **"임시"**: 카테고리 삭제 시 자동 생성되거나 기존 임시 카테고리 사용

### 카테고리 삭제 규칙

- 빈 카테고리만 삭제 가능
- 카드가 있는 경우: 자동 이동(임시 카테고리) 또는 수동 이동(사용자 선택) 지원

## 예상 도메인 객체 (업데이트됨)

### 애그리게이트 후보

- CategoryHierarchy (카테고리 계층 애그리게이트)

### 엔티티 후보

- Category (카테고리)
- CategoryNode (계층 구조의 노드)

### 값 객체 후보

- CategoryName (카테고리 이름)
- CategoryType (카테고리 유형 - 일반/공유받은카드/임시)
- CategoryPath (카테고리 경로 - 계층 구조)
- HierarchyLevel (계층 레벨 - 1~3)

### 도메인 이벤트 후보

- CategoryCreated (카테고리 생성됨)
- CategoryRenamed (카테고리 이름 변경됨)
- CategoryDeleted (카테고리 삭제됨)
- CategoryMoved (카테고리 이동됨)
- SharedCardsCategoryCreated (공유받은 카드 카테고리 생성됨)
- TemporaryCategoryCreated (임시 카테고리 생성됨)
- CardsMovedToCategory (카드들이 카테고리로 이동됨)

### 도메인 서비스 후보

- CategoryDeletionService (카테고리 삭제 서비스)
- CategoryHierarchyService (카테고리 계층 관리 서비스)
- DefaultCategoryCreationService (기본 카테고리 생성 서비스)
- CardMigrationService (카드 이동 서비스)

## 논리적 설계 생성 계획

### 6단계: 논리적 설계 생성

- [x] 6.1 애플리케이션 서비스 계층 설계
- [x] 6.2 도메인 서비스 구현 명세 작성
- [x] 6.3 리포지토리 구현 명세 작성
- [x] 6.4 API 컨트롤러 설계
- [x] 6.5 DTO 및 요청/응답 모델 설계
- [x] 6.6 이벤트 핸들러 설계
- [x] 6.7 예외 처리 및 오류 응답 설계
- [x] 6.8 데이터베이스 테이블 설계 상세화
- [x] 6.9 논리적 설계 문서 작성 완료

### 7단계: 시퀀스 다이어그램 생성

- [x] 7.1 카테고리 생성 시퀀스 다이어그램
- [x] 7.2 카테고리 목록 조회 시퀀스 다이어그램
- [x] 7.3 카테고리 이름 수정 시퀀스 다이어그램
- [x] 7.4 카테고리 삭제 시퀀스 다이어그램 (동기/비동기)
- [x] 7.5 시스템 카테고리 자동 생성 시퀀스 다이어그램
- [x] 7.6 시퀀스 다이어그램 문서 작성 완료

---
**Unit2 논리적 설계가 완료되었습니다!**

## 완료된 주요 개선사항
- **하위 카테고리 이동**: 삭제 시 하위 카테고리를 다른 부모로 이동 가능
- **삭제 미리보기**: 삭제 영향도를 사전에 확인할 수 있는 API 제공
- **하이브리드 처리**: 작업량에 따른 동기/비동기 처리 분기
- **상태 관리**: 삭제 진행 중 카테고리 상태 표시
- **PostgreSQL + Redis**: Unit1과 일관된 기술 스택 사용
